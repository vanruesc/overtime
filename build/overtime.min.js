/**
 * overtime v0.1.1 build Sep 18 2015
 * https://github.com/vanruesc/overtime
 * Copyright 2015 Raoul van Rueschen, Zlib
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Overtime=e()}(this,function(){"use strict";function t(){this._listeners={}}function e(i){var s,n=this;if(t.call(this),this.TWO_PI=2*Math.PI,this.HALF_PI=.5*Math.PI,this.clearCanvas=!0,this.animId=0,this.now=Date.now(),this.then=this.now,this.ctx=null,this.canvas=document.createElement("canvas"),this.startAngle=-this.HALF_PI,this.threshold=.023,this.fullCircle=this.startAngle+this.TWO_PI,this.primaryStrokeStyle="rgba(255, 100, 0, 0.9)",this.secondaryStrokeStyle="rgba(0, 0, 0, 0.1)",this.updateEvent={type:"update",time:0},this.tm=e.TimeMeasure.MILLISECONDS,this.t=1,void 0!==i&&(i.timeMeasure>0&&(this.tm=i.timeMeasure),i.time>0&&(this.t=i.time),void 0!==i.canvas&&(this.canvas=i.canvas),this.size=i.size),this.t*=this.tm,this.T=this.t,localStorage.getItem("overtime"))try{s=JSON.parse(localStorage.getItem("overtime")),void 0!==s.tm&&(this.tm=s.tm),void 0!==s.t&&(this.t=s.t),void 0!==s.T&&(this.T=s.T)}catch(h){}window.addEventListener("unload",function(){localStorage.setItem("overtime",JSON.stringify({tm:n.tm,t:n.t,T:n.T}))}),this.update=function(){n._update()}}return t.prototype.apply=function(e){e._listeners={},e.addEventListener=t.prototype.addEventListener,e.hasEventListener=t.prototype.hasEventListener,e.removeEventListener=t.prototype.removeEventListener,e.dispatchEvent=t.prototype.dispatchEvent},t.prototype.addEventListener=function(t,e){void 0===this._listeners[t]&&(this._listeners[t]=[]),-1===this._listeners[t].indexOf(e)&&this._listeners[t].push(e)},t.prototype.hasEventListener=function(t,e){return void 0!==this._listeners[t]&&-1!==this._listeners[t].indexOf(e)},t.prototype.removeEventListener=function(t,e){var i,s;s=this._listeners[t],void 0!==s&&(i=s.indexOf(e),-1!==i&&s.splice(i,1))},t.prototype.dispatchEvent=function(t){var e,i,s;if(s=this._listeners[t.type],void 0!==s)for(t.target=this,e=0,i=s.length;i>e;++e)s[e].call(this,t)},e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Object.defineProperty(e.prototype,"canvas",{get:function(){return this.ctx.canvas},set:function(t){void 0!==t&&void 0!==t.getContext&&(this.stop(),this.ctx=t.getContext("2d"),this.ctx.strokeStyle=this.primaryStrokeStyle,this.size=[t.width,t.height])}}),Object.defineProperty(e.prototype,"time",{get:function(){return this.t},set:function(t){t>=0&&(this.stop(),this.t=t*this.tm,this.T=this.t,this._render())}}),Object.defineProperty(e.prototype,"timeMeasure",{get:function(){return this.tm},set:function(t){t>0&&(this.tm=t)}}),Object.defineProperty(e.prototype,"size",{get:function(){return[this.ctx.canvas.width,this.ctx.canvas.height]},set:function(t){void 0!==t&&(this.ctx.canvas.width=t[0],this.ctx.canvas.height=t[1],this.ctx.lineWidth=t[0]<t[1]?.05*t[0]:.05*t[1],this._render())}}),e.prototype._render=function(){var t,e,i=this.ctx,s=i.canvas.width,n=i.canvas.height,h=s>>1,o=n>>1,r=n>s?h:o;this.clearCanvas&&i.clearRect(0,0,s,n),r-=i.lineWidth,t=this.startAngle+this.TWO_PI*((this.T-this.t)/this.T),e=t-this.startAngle<this.threshold,i.strokeStyle=this.primaryStrokeStyle,i.beginPath(),i.arc(h,o,r,e?this.startAngle-this.threshold:this.startAngle,t,!1),i.stroke(),e&&i.clearRect(0,0,h-this.threshold,o),t<this.fullCircle&&(i.strokeStyle=this.secondaryStrokeStyle,i.beginPath(),i.arc(h,o,r,t,this.fullCircle,!1),i.stroke())},e.prototype._update=function(){var t;this.now=Date.now(),t=this.now-this.then,this.then=this.now,this.t-=t,this.t<0&&(this.t=0),this.updateEvent.time=this.t,this.dispatchEvent(this.updateEvent),this._render(),this.t>0?this.animId=requestAnimationFrame(this.update):this.dispatchEvent({type:"elapsed"})},e.prototype.stop=function(){0!==this.animId&&(cancelAnimationFrame(this.animId),this.animId=0)},e.prototype.start=function(){this.stop(),this.now=Date.now(),this.then=this.now,this.update()},e.prototype.rewind=function(){this.stop(),this.t=this.T,this._render()},e.prototype.rewindBy=function(t){"number"!=typeof t||isNaN(t)||0===t||(this.stop(),this.t+=t*this.tm,this.t>this.T&&(this.t=this.T),this._render())},e.prototype.advanceBy=function(t){"number"!=typeof t||isNaN(t)||this.rewindBy(-t)},e.prototype.prolongBy=function(t){"number"!=typeof t||isNaN(t)||0===t||(this.stop(),t*=this.tm,this.t+=t,this.T+=t,this.T<0&&(this.T=this.t=0),this._render())},e.prototype.shortenBy=function(t){"number"!=typeof t||isNaN(t)||this.prolongBy(-t)},e.TimeMeasure=Object.freeze({MILLISECONDS:1,SECONDS:1e3,MINUTES:6e4,HOURS:36e5}),e});